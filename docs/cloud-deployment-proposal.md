# 클라우드 배포 제안서

## 개요

**문서 유형**: 기술 제안서
**작성일**: 2026년 01월 27일
**목적**: 로컬 환경에서 운영 중인 QA 자동화 도구를 클라우드/외부 환경으로 이전하기 위한 아키텍처 옵션 분석

---

## 현재 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        현재 (로컬)                               │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│  │ Frontend │ ←→ │ Backend  │ ←→ │  Appium  │ ←→ │ Devices  │  │
│  │ :5173    │    │ :3001    │    │  :4900   │    │ (USB/ADB)│  │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘  │
│       ↑                                                ↑        │
│       └────────────── 모두 로컬 ───────────────────────┘        │
└─────────────────────────────────────────────────────────────────┘
```

### 컴포넌트별 특성

| 컴포넌트 | 기술 스택 | 포트 | 특이사항 |
|---------|----------|------|---------|
| Frontend | React, Vite | 5173 | 정적 파일, CDN 배포 가능 |
| Backend | Express, Socket.IO | 3001 | WebSocket 실시간 통신 |
| Appium | UiAutomator2 | 4900 | 디바이스와 동일 네트워크 필수 |
| Devices | Android (50대) | USB | 물리적 연결 필수 |

---

## 클라우드 이전 제약 분석

### 이전 가능 여부

| 컴포넌트 | 클라우드 이전 | 이유 |
|---------|-------------|------|
| Frontend | ✅ 가능 | 정적 파일, CDN 배포 용이 |
| Backend API | ✅ 가능 | 일반 Node.js 서버 |
| Appium 서버 | ⚠️ 조건부 | 디바이스와 같은 네트워크 필요 |
| 물리 디바이스 | ❌ 불가 | USB 연결 필수 |

### 핵심 제약

**물리 디바이스 연결 문제**
- Android 디바이스는 ADB(Android Debug Bridge)를 통해 제어
- ADB는 USB 또는 TCP/IP 연결 필요
- TCP/IP 모드는 보안 취약점 존재 (인증 없음)
- 50대 규모 디바이스 관리 시 USB 허브 + 물리 서버 필수

---

## 배포 옵션

### Option 1: 하이브리드 아키텍처 (권장)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         하이브리드 아키텍처                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────── 클라우드 (AWS/GCP/Vercel) ───────┐                            │
│  │  ┌──────────┐    ┌──────────────────┐   │                            │
│  │  │ Frontend │    │ Backend (API)    │   │                            │
│  │  │ (Vercel) │    │ (EC2/Cloud Run)  │   │                            │
│  │  └──────────┘    └────────┬─────────┘   │                            │
│  └───────────────────────────┼─────────────┘                            │
│                              │ HTTPS/WSS                                │
│                              ▼                                          │
│  ┌─────── 사내 Device Farm (물리 서버) ────┐                            │
│  │  ┌──────────┐    ┌──────────┐           │    ┌──────────────────┐   │
│  │  │ Appium   │ ←→ │ Device   │ ←── USB ──┼───→│  50대 디바이스    │   │
│  │  │ Gateway  │    │ Agent    │           │    │  (USB 허브 연결)  │   │
│  │  └──────────┘    └──────────┘           │    └──────────────────┘   │
│  │       ↑                                 │                            │
│  │  Tailscale/WireGuard 터널              │                            │
│  └─────────────────────────────────────────┘                            │
└─────────────────────────────────────────────────────────────────────────┘
```

**장점**
- Frontend/Backend는 클라우드 확장성 확보
- 디바이스 팜만 물리 서버로 유지
- 외부 접근 가능 (재택, 출장 중에도 테스트 가능)
- 장애 격리 (클라우드/디바이스 팜 독립)

**단점**
- 아키텍처 복잡도 증가
- 클라우드-온프레미스 간 네트워크 지연
- 터널링 설정 및 유지보수 필요

**필요 인프라**
- 클라우드: Vercel (Frontend), AWS EC2 또는 GCP Cloud Run (Backend)
- 온프레미스: 물리 서버 1대, USB 허브, Tailscale/WireGuard

**예상 월 비용**

| 항목 | 비용 |
|------|------|
| Vercel (Frontend) | 무료 ~ $20 |
| AWS EC2 t3.medium | ~$30 |
| Tailscale | 무료 (개인) ~ $6/user |
| 사내 서버 전기료 | ~$10 |
| **합계** | **~$50-70** |

---

### Option 2: 완전 온프레미스 + 외부 접근

```
┌─────────────────────────────────────────────────────────────────┐
│                    온프레미스 + Cloudflare Tunnel                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────── 사내 서버 ─────────────────────────────────────────┐  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │  │
│  │  │ Frontend │  │ Backend  │  │  Appium  │  │ Devices  │  │  │
│  │  │ (nginx)  │  │ (pm2)    │  │  :4900   │  │  (USB)   │  │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │  │
│  │       │              │                                    │  │
│  │       └──────────────┼────────────────────────────────────┘  │
│  │                      ▼                                       │
│  │              Cloudflare Tunnel                               │
│  └──────────────────────┬───────────────────────────────────────┘
│                         │                                       │
│                         ▼                                       │
│                  https://qa-tool.company.com                    │
└─────────────────────────────────────────────────────────────────┘
```

**장점**
- 가장 단순한 구조
- 네트워크 지연 최소화 (모든 컴포넌트 로컬)
- 클라우드 비용 거의 없음
- 설정 및 유지보수 용이

**단점**
- 서버 다운 시 전체 시스템 중단
- 확장성 제한
- 서버 하드웨어 관리 필요

**필요 인프라**
- 사내 서버 (Windows/Linux, 최소 8GB RAM)
- Cloudflare Tunnel 또는 ngrok
- pm2/Docker로 프로세스 관리
- UPS (정전 대비)

**예상 월 비용**

| 항목 | 비용 |
|------|------|
| Cloudflare Tunnel | 무료 |
| 도메인 | ~$1 |
| 전기료 | ~$10 |
| **합계** | **~$11** |

---

### Option 3: 클라우드 Device Farm 서비스

AWS Device Farm, Firebase Test Lab, BrowserStack 등 외부 서비스 활용

**장점**
- 디바이스 관리 불필요
- 다양한 디바이스/OS 버전 테스트 가능
- 인프라 관리 부담 없음

**단점**
- 현재 Appium 아키텍처와 호환 어려움 (자체 API 사용)
- 비용이 매우 높음 (분당 과금)
- 게임 앱 테스트 제약 (GPU 필요 시)
- 커스텀 자동화 시나리오 제한

**예상 월 비용**

| 서비스 | 디바이스 분당 | 50대 × 8시간/일 × 20일 |
|--------|-------------|----------------------|
| AWS Device Farm | $0.17 | ~$8,160 |
| Firebase Test Lab | $0.08 | ~$3,840 |
| BrowserStack | $0.20 | ~$9,600 |

**결론**: 50대 규모에서는 비용 대비 효율이 매우 낮음

---

## 구현 로드맵 (Option 1 기준)

### Phase 1: Device Farm 서버 구축 (1주)

1. 사내 서버 준비 (Mini PC 또는 기존 서버)
2. Node.js, JDK, Android SDK 설치
3. Appium 서비스 등록 (systemd/pm2)
4. Device Agent 구현
   - ADB 디바이스 스캔
   - 상태 보고 API
   - WebSocket 이벤트 중계

### Phase 2: Backend 분리 (1주)

1. Appium 직접 호출 → Device Farm API 호출로 변경
2. 세션 관리 로직 분리
3. 스크린샷/비디오 스트리밍 프록시 구현

```typescript
// Before: 직접 호출
const driver = await remote({ hostname: 'localhost', port: 4900 });

// After: Device Farm API
const driver = await deviceFarmClient.createSession(deviceId);
```

### Phase 3: 클라우드 배포 (3일)

1. Frontend → Vercel 배포
2. Backend → AWS EC2 배포
3. 환경 변수 설정
4. SSL 인증서 설정

### Phase 4: 터널링 설정 (1일)

1. Tailscale 설치 (사내 서버)
2. ACL 설정 (Backend만 접근 허용)
3. 연결 테스트

---

## 보안 고려사항

### 인증/인가
- Slack OAuth로 워크스페이스 멤버만 접근 (구현 완료)
- JWT 토큰 기반 API 인증 (구현 완료)
- Device Farm API에도 동일 인증 적용 필요

### 네트워크
- Tailscale/WireGuard: 암호화된 P2P 터널
- 디바이스 팜 서버는 VPN 내부에서만 접근 가능
- 클라우드 Backend → 디바이스 팜 단방향 통신

### 데이터
- 테스트 결과/리포트는 클라우드 저장 (S3/R2)
- 디바이스 스크린샷은 암호화 전송
- 민감 정보(앱 데이터) 로깅 금지

---

## 결론 및 권장사항

### 상황별 권장 옵션

| 상황 | 권장 옵션 | 이유 |
|------|----------|------|
| 즉시 외부 접근 필요 | Option 2 + Cloudflare Tunnel | 무료, 설정 간단 |
| 안정적 프로덕션 운영 | Option 1 (하이브리드) | 확장성, 장애 격리 |
| 최소 비용 우선 | Option 2 (온프레미스) | 월 ~$11 |
| 디바이스 수 적음 (5대 미만) | Option 3 검토 | 관리 부담 없음 |

### 핵심 결론

> **물리 디바이스를 사용하는 한, 최소 1대의 물리 서버는 디바이스와 같은 위치에 있어야 합니다.**
>
> 완전한 클라우드 이전은 에뮬레이터만 사용하거나, 클라우드 Device Farm 서비스(고비용)를 사용하지 않는 한 불가능합니다.

### 단기 권장

현재 상태에서 외부 접근만 필요하다면:

```bash
# Cloudflare Tunnel로 즉시 외부 노출 (무료)
cloudflared tunnel --url http://localhost:5173
```

### 장기 권장

프로덕션 레벨 운영 시 Option 1 (하이브리드) 아키텍처로 전환하여:
- 클라우드 확장성 확보
- 장애 격리
- 외부 접근 안정화

---

*최종 수정일: 2026-01-27*
